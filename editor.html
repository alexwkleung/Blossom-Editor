<!DOCTYPE html>

<title>Blossom Editor</title>
<meta charset="UTF-8"/>

<!-- styles -->
<link rel=stylesheet href="codemirror/lib/codemirror.css">
<link rel=stylesheet href="codemirror/addon/dialog/dialog.css">

<!-- fonts -->
<!-- ibm plex sans - bold 700 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@700&display=swap" rel="stylesheet">

<!-- styles - themes -->
<link rel=stylesheet href="codemirror/theme/3024-night.css">
<link rel=stylesheet href="codemirror/theme/duotone-dark.css">
<link rel=stylesheet href="codemirror/theme/paraiso-dark.css">
<link rel=stylesheet href="codemirror/theme/material-darker.css">
<link rel=stylesheet href="codemirror/theme/gruvbox-dark.css">
<link rel=stylesheet href="codemirror/theme/abcdef.css">
<link rel=stylesheet href="codemirror/theme/zenburn.css">
<link rel=stylesheet href="codemirror/theme/xq-dark.css">
<link rel=stylesheet href="codemirror/other-themes/darkpastel.css">

<!-- codemirror script -->
<script src="codemirror/lib/codemirror.js"></script>

<!-- mode scripts -->
<script src="codemirror/mode/javascript/javascript.js"></script>
<script src="codemirror/mode/css/css.js"></script>
<script src="codemirror/mode/xml/xml.js"></script>
<script src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="codemirror/mode/clike/clike.js"></script>
<script src="codemirror/mode/markdown/markdown.js"></script>
<script src="codemirror/mode/stex/stex.js"></script>

<!-- addon scripts -->
<script src="codemirror/addon/search/search.js"></script>
<script src="codemirror/addon/search/searchcursor.js"></script>
<script src="codemirror/addon/search/jump-to-line.js"></script>
<script src="codemirror/addon/dialog/dialog.js"></script>
<script src="codemirror/addon/display/autorefresh.js"></script>
<script src="codemirror/addon/edit/closebrackets.js"></script>
<script src="codemirror/addon/edit/closetag.js"></script>

<!-- internal styles -->
<style>
  /*
  .CodeMirror { height: 100%; border: 1px hidden #ddd; background-color: black; }

  .CodeMirror-scroll { max-height: 100%; }

  .CodeMirror pre { padding-left: 7px; line-height: 1.25; }
  */

  body { background-color: #B39DDB; }
  
  .button-center { display: flex; justify-content: center; }
  
  .border { height: 53px; border-style: hidden; -webkit-user-select: none; user-select: none; -webkit-app-region: drag; }
  
  select { height: 48px; width: 125px; }
  
  .mode { height: 48px; width: 135px; }

  select { font-family: 'IBM Plex Sans', 'sans-serif'; }

  .button-center-shortcut { display: flex; justify-content: center; }

  .border-shorcut { height: 53px; border-style: hidden; -webkit-user-select: none; user-select: none; -webkit-app-region: drag; }

  summary { font-family: 'IBM Plex Sans', 'sans-serif'; }

  .shortcut-p { text-align: left; }
</style>

<div class="border-shortcut">
  <div class="button-center-shortcut">
  <button title="keyboard shortcuts" type="button">
    <details>
    <summary accesskey="h">KB Shortcuts</summary>
    <p class="shortcut-p">
    1) [Control+Option+S] or [Control+Option+Shift+S]: Save file
    <br>
    <br>
    2) [Command+Shift+F]: Go into Fullscreen.
    <br>
    <br>
    3) [Command+Shift+T]: Toggle the tab bar. Available when only one tab is opened.
    <br>
    <br>
    4) [Control+Option+K] or [Control+Option+Shift+K]: Refresh/clear editor.
    <br>
    <br>
    5) [Control+Option+W] or [Control+Option+Shift+W]: Open new window.
    <br>
    <br>
    6) [Control+Option+C] or [Control+Option+Shift+C]: Close window.
    <br>
    <br>
    7) [Control+Option+H] or [Control+Option+Shift+H]: Show keyboard shortcuts.
    <br>
    <br>
    8) [Control+Tab]: Select the next tab.
    <br>
    <br>
    9) [Control+Shift+Tab]: Select the previous tab.
    </p>
    </details>
    </button>
    </div>
  </div>

<!-- button navigations -->
<div class="border">
<div class="button-center">
  
<button title="save" type="button" accesskey="s" onclick="save()"><img src="codemirror/img/save.png"></button> 
<button title="toggle fullscreen" type="button" onclick="toggleFullScreen()"><img src="codemirror/img/fullscreen.png"></button>

<button title="change theme" type="button">
  <select onchange="selectTheme()" id=select>
    <!-- theme options -->
    <option selected>3024-night</option>
    <option>duotone-dark</option>
    <option>paraiso-dark</option>
    <option>material-darker</option>
    <option>gruvbox-dark</option>
    <option>abcdef</option>
    <option>zenburn</option>
    <option>xq-dark</option>
  </select>
</button>

<button title="open new window" type="button" accesskey="w" onclick="window.open('editor.html', '', 'width=1280, height=750, y=500, x=800, resizable=true, fullscreenable=true')"><img src="codemirror/img/new-window.png"></button>

<button title="change mode" type="button">
  <select class="mode" onchange="selectMode()" id=mode>
    <!-- mode options -->
    <option selected>text/plain</option>
    <option>clike</option>
    <option>text/javascript</option>
    <option>text/html</option>
    <option>text/x-markdown</option>
    <option>text/x-stex</option>
  </select>
</button>

<button title="refresh/clear editor" type="button" accesskey="k" onclick="window.location.reload()"><img src="codemirror/img/clear.png"></button>
<button title="close tab" type="button" accesskey="c" onclick="window.close()"><img src="codemirror/img/close.png"></button>
</div>

<!-- CodeMirror editor area -->
<textarea id="editor"></textarea>

<!-- editor script -->
<script>
  const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
    lineNumbers: true,
    mode: "text/plain",
    theme: '3024-night',
    smartIndent: false,
    autoRefresh: true,
    scrollbarStyle: null,
    autoCloseTags: true,
    //lineWrapping: true,
  });
  editor.setSize("100%", "1440")
  //const textToWrite = editor.doc.getValue();

  //theme switching - credit: https://github.com/codemirror/CodeMirror/blob/master/demo/theme.html
  const input = document.getElementById("select");
  function selectTheme() {
    const theme = input.options[input.selectedIndex].textContent;
    editor.setOption("theme", theme);
    location.hash = "#" + theme;
  }

  const choice = (location.hash && location.hash.slice(1)) || (document.location.search && decodeURIComponent(document.location.search.slice(1)));
  
  if(choice) {
    input.value = choice;
    editor.setOption("theme", choice);
  }

  CodeMirror.on(window, "hashchange", function() {
    const theme = location.hash.slice(1);
    if(theme) { 
      input.value = theme; 
      selectTheme(); 
    }
  });

  //mode switching
  const modeInput = document.getElementById("mode");
  function selectMode() {
    const mode = modeInput.options[modeInput.selectedIndex].textContent;
    editor.setOption("mode", mode);
  }
</script>

<!-- save to file - credit: https://stackoverflow.com/questions/51315044/how-do-i-save-the-content-of-the-editor-not-the-whole-html-page -->
<script>
  function save() {
    const textToWrite = editor.getValue();
    const textFileAsBlob = new Blob([textToWrite], {
    type: "text/plain; charset=utf-8"
  });

  const fileNameToSaveAs = "blossom.txt";
  const downloadLink = document.createElement("a");

  downloadLink.download = fileNameToSaveAs;
  downloadLink.innerHTML = "Download File";

  if(window.webkitURL !== null) {
    //"Chrome allows the link to be clicked without adding it to the DOM."
    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    }
    downloadLink.click();
  }
</script>

<!-- toggle fullscreen - credit: https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API -->
<script>
  function toggleFullScreen() {
  if(!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
  } else {
    if(document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}
</script>